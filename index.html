<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Undercover Shift 3D</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: monospace; }
    canvas { display: block; }#joystick {
  position: absolute;
  bottom: 40px;
  right: 40px;
  width: 100px;
  height: 100px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 50%;
  touch-action: none;
}

#joystick-handle {
  width: 50px;
  height: 50px;
  background: #00ffff;
  border-radius: 50%;
  position: relative;
  left: 25px;
  top: 25px;
  touch-action: none;
}

#interact {
  position: absolute;
  bottom: 40px;
  left: 40px;
  background: #008cff;
  color: white;
  font-size: 18px;
  padding: 15px 25px;
  border: none;
  border-radius: 12px;
  touch-action: manipulation;
}

#dialogue, #hud {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 10px 20px;
  border-radius: 10px;
  display: none;
}

#dialogue {
  bottom: 100px;
}

#hud {
  top: 20px;
  display: flex;
  gap: 20px;
}

.bar {
  width: 120px;
  height: 20px;
  background: #444;
  border-radius: 10px;
  overflow: hidden;
}

.bar-fill {
  height: 100%;
  transition: width 0.2s;
}

.police { background: #00ccff; }
.gang { background: #ff4444; }

  </style>
</head>
<body>
  <div id="dialogue">Razor: You lost, cop?</div>
  <div id="hud">
    <div class="bar"><div id="policeBar" class="bar-fill police" style="width: 50%"></div></div>
    <div class="bar"><div id="gangBar" class="bar-fill gang" style="width: 50%"></div></div>
  </div>
  <div id="joystick"><div id="joystick-handle"></div></div>
  <button id="interact">Talk</button>  <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>  <script>
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x222222);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(5, 10, 7);
    scene.add(ambientLight, directionalLight);

    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(500, 500),
      new THREE.MeshStandardMaterial({ color: 0x333333 })
    );
    ground.rotation.x = -Math.PI / 2;
    scene.add(ground);

    for (let i = 0; i < 20; i++) {
      const building = new THREE.Mesh(
        new THREE.BoxGeometry(5, Math.random() * 10 + 5, 5),
        new THREE.MeshStandardMaterial({ color: 0x555555 })
      );
      building.position.set((Math.random() - 0.5) * 200, building.geometry.parameters.height / 2, (Math.random() - 0.5) * 200);
      scene.add(building);
    }

    const player = new THREE.Mesh(
      new THREE.CapsuleGeometry(0.5, 1, 4, 8),
      new THREE.MeshStandardMaterial({ color: 0x00ffff })
    );
    player.position.set(0, 1, 0);
    scene.add(player);

    const npc = new THREE.Mesh(
      new THREE.CapsuleGeometry(0.5, 1, 4, 8),
      new THREE.MeshStandardMaterial({ color: 0xff4444 })
    );
    npc.position.set(5, 1, 0);
    scene.add(npc);

    // Custom police officer model (made from primitives)
    const policeGroup = new THREE.Group();
    const torso = new THREE.Mesh(
      new THREE.BoxGeometry(1, 1.2, 0.6),
      new THREE.MeshStandardMaterial({ color: 0x0000cc })
    );
    torso.position.y = 1.6;
    policeGroup.add(torso);

    const head = new THREE.Mesh(
      new THREE.SphereGeometry(0.3, 16, 16),
      new THREE.MeshStandardMaterial({ color: 0xffcc99 })
    );
    head.position.y = 2.3;
    policeGroup.add(head);

    const hat = new THREE.Mesh(
      new THREE.CylinderGeometry(0.32, 0.32, 0.2, 12),
      new THREE.MeshStandardMaterial({ color: 0x000099 })
    );
    hat.position.y = 2.55;
    policeGroup.add(hat);

    policeGroup.position.set(-5, 0, 0);
    scene.add(policeGroup);

    camera.position.set(0, 10, 10);
    camera.lookAt(player.position);

    const joystick = document.getElementById('joystick');
    const handle = document.getElementById('joystick-handle');
    let moveX = 0, moveZ = 0;

    joystick.addEventListener('touchmove', e => {
      const touch = e.touches[0];
      const rect = joystick.getBoundingClientRect();
      const dx = touch.clientX - (rect.left + rect.width / 2);
      const dy = touch.clientY - (rect.top + rect.height / 2);
      const dist = Math.min(Math.sqrt(dx * dx + dy * dy), 40);
      const angle = Math.atan2(dy, dx);
      const offsetX = Math.cos(angle) * dist;
      const offsetY = Math.sin(angle) * dist;
      handle.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
      moveX = offsetX / 40;
moveZ = offsetY / 40;
    });

    joystick.addEventListener('touchend', () => {
      handle.style.transform = 'translate(0px, 0px)';
      moveX = 0;
      moveZ = 0;
    });

    document.getElementById('interact').addEventListener('click', () => {
      if (player.position.distanceTo(npc.position) < 2) {
        document.getElementById('dialogue').style.display = 'block';
        adjustTrust(-5, 10);
      }
    });

    let policeTrust = 50;
    let gangTrust = 50;

    function adjustTrust(policeDelta, gangDelta) {
      policeTrust = Math.max(0, Math.min(100, policeTrust + policeDelta));
      gangTrust = Math.max(0, Math.min(100, gangTrust + gangDelta));
      document.getElementById('policeBar').style.width = policeTrust + '%';
      document.getElementById('gangBar').style.width = gangTrust + '%';
    }

    function animate() {
      requestAnimationFrame(animate);

      player.position.x += moveX * 0.1;
      player.position.z += moveZ * 0.1;

      camera.position.x = player.position.x;
      camera.position.z = player.position.z + 10;
      camera.lookAt(player.position);

      renderer.render(scene, camera);
    }

    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script></body>
</html>
